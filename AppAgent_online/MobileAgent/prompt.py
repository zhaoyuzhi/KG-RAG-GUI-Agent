def get_action_prompt(instruction, history):

# -------------------------------------------------------任务描述-------------------------------------------------------

    prompt = f"""我想要{instruction}。请帮我确定接下来需要执行的单步交互操作。\n"""

# -------------------------------------------------------交互操作-------------------------------------------------------

    prompt += """\n### 操作函数
为了确保清晰的表述，所有单步交互操作总结为以下几个函数：
1. `click(index: int)`: 点击指定的控件。参数‘index’是该控件的编号。例如，`click(5)`表示点击编号为5的控件。
2. `text(index: int, content: str)`: 在可输入文本的指定控件中输入指定内容。参数‘index’是该控件的编号，‘content’是需要输入的内容。例如，`text(5, "Hello, world!")`表示在编号为5的控件中输入‘Hello, world!’。
3. `scroll(direction: str)`: 滚动页面。参数‘direction’是滚动方向，可以是‘up’或‘down’。例如，`scroll("up")`表示向上滚动当前页面，即查看页面上方的内容。
4. `swipe(index: int, direction: str)`: 滑动指定的控件。参数‘index’是该控件的编号，‘direction’是滑动方向，可以是‘up’、‘down’、‘left’、‘right’。例如，`swipe(5, "up")`表示向上滑动编号为5的控件。
5. `long_press(index: int)`: 长按指定的控件。参数‘index’是该控件的编号。例如，`long_press(5)`表示长按编号为5的控件。
6. `battery()`: 特殊函数，采集耗电量信息。
7. `back()`: 系统级操作‘返回’，回到当前界面之前的界面。
8. `finish()`: 特殊函数，表示操作过程结束。当你认为历史操作已经使操作意图完成时调用此函数。\n"""

#     prompt += """\n### 操作函数
# 为了确保清晰的表述，所有单步交互操作总结为以下几个函数：
# 1. `click(index: int)`: 点击指定的控件。参数‘index’是该控件的编号。例如，`click(5)`表示点击编号为5的控件。
# 2. `text(index: int, content: str)`: 在可输入文本的指定控件中输入指定内容。参数‘index’是该控件的编号，‘content’是需要输入的内容。例如，`text(5, "Hello, world!")`表示在编号为5的控件中输入‘Hello, world!’。
# 3. `scroll(direction: str)`: 滚动页面。参数‘direction’是滚动方向，可以是‘up’或‘down’。例如，`scroll("up")`表示向上滚动当前页面，即查看页面上方的内容。
# 4. `swipe(index: int, direction: str)`: 滑动指定的控件。参数‘index’是该控件的编号，‘direction’是滑动方向，可以是‘up’、‘down’、‘left’、‘right’。例如，`swipe(5, "up")`表示向上滑动编号为5的控件。
# 5. `long_press(index: int)`: 长按指定的控件。参数‘index’是该控件的编号。例如，`long_press(5)`表示长按编号为5的控件。
# 6. `back()`: 系统级操作‘返回’，回到当前界面之前的界面。
# 7. `finish()`: 特殊函数，表示操作过程结束。当你认为历史操作已经使操作意图完成时调用此函数。
# 特别地，如果你认为需要交互的控件未被标注，请将参数‘index’设为‘N\A’，并根据第三张图片的坐标线确定控件的中心坐标(x, y)。在输出中，会有一个专门的字段用于填写坐标。\n"""

# -------------------------------------------------------操作意图-------------------------------------------------------

    # prompt += f"\n### 操作意图\n当前的操作意图是：{instruction}\n"


# -------------------------------------------------------历史操作-------------------------------------------------------

    if len(history) > 0:
        prompt += """\n### 历史操作
为了实现操作意图，你曾经做出了一些操作，并预测了操作后的效果：\n"""
#         prompt += """\n### 历史操作
# 为了实现操作意图，你曾经做出了一些操作：\n"""
        for i in range(len(history)):
            prompt += f"{i + 1}. {history[i]}\n"
        prompt += """记住，历史操作不一定是正确的，你应该批判性的看待它们。\n"""
#
# # -------------------------------------------------------无效操作-------------------------------------------------------
#
# #     prompt += """\n### 无效操作
# # 你曾经在当前页面中做出过一些无效的操作，这些操作并没有使操作意图得以实现，你应该避免重复它们：
# # 1. 点击了页面右上角的搜索按钮，以便搜索“雷军”并找到他的最新微博。
# # 2. 点击页面左上角的搜索按钮进入搜索界面，以便能够搜索“雷军”找到他的最新微博。
# # 记住，历史操作不一定是正确的，你应该批判性的看待它们。\n"""
#
# -------------------------------------------------------操作文档-------------------------------------------------------

    prompt += """
### 操作文档
以下是App操作文档中检索到的一个章节，可能会对你的操作有帮助。
"""

#     prompt += """\"\"\"
# --- 操作文档：如何查看微博热搜榜的第一名 ---
# * 起始页面：微博的推荐页面
# * 操作步骤：
#   步骤1：
#   - 页面：当前页面是微博的推荐页面，顶部有多个标签，包括热门、实时、同城等。页面中展示了多个微博内容，包含图片、文字和互动按钮（如评论、点赞）。底部有导航栏，包含首页、视频、发现、消息和我五个选项。
#   - 操作：点击底部导航栏中的“发现”按钮。
#   - 解释：要查看微博热搜榜，通常需要进入微博的发现页面，因为热搜榜通常在发现页面中展示。点击“发现”按钮是进入该页面的必要步骤。
#   步骤2：
#   - 页面：当前页面是微博的发现页面，顶部有搜索栏，下面有几个标签，包括“发现”、“热点”、“视频”和“榜单”。页面中部显示了微博热搜榜的部分内容，列出了几条热搜话题。页面底部有一个广告和一些分类标签。
#   - 操作：点击页面中部靠右侧的“更多热搜”按钮。
#   - 解释：当前页面只显示了部分热搜话题，并没有显示完整的热搜榜单。点击“更多热搜”按钮可以进入完整的热搜榜单页面，从而查看热搜的第一名。
#   步骤3：
#   - 页面：当前页面是微博热搜页面，顶部显示“微博热搜”标题，下方有多个标签选项，包括“我的”、“热搜”、“文娱”、“同城”、“要闻”和“更多”。当前选中的标签是“我的”，页面下方显示了多个热搜条目。
#   - 操作：点击页面顶部的“热搜”标签。
#   - 解释：当前页面显示的是“我的”标签下的内容，而不是热搜榜单。点击“热搜”标签可以切换到热搜榜单页面，从而查看热搜的第一名。
#   步骤4：
#   - 页面：页面显示的是微博热搜榜单，顶部有微博热搜的标志和导航栏，导航栏中‘热搜’标签被选中。页面中间部分是热搜榜单，按顺序列出了当前的热搜话题，每个话题旁边有热度数值。
#   - 操作：点击热搜榜单中排名第一的热搜话题。
#   - 解释：热搜榜单按顺序排列，第一名的热搜话题位于榜单的最上方。点击该话题可以查看其详细内容。
# 完成以上步骤后，用户将跳转到显示微博热搜榜第一名话题的页面，页面中部显示该热搜的详细内容，包括阅读量、讨论量和相关媒体发布的信息。
# \"\"\"
# """

#     prompt += """\"\"\"
# --- 操作文档：如何使用账号和密码登录高德地图 ---
# * 起始页面：高德地图的主界面
# * 操作步骤：
#   步骤1：
#   - 页面：当前页面显示的是高德地图的主界面，地图上标注了多个地点和地标。页面底部有一个导航栏，包含‘首页’、‘附近’、‘消息’、‘打车’和‘未登录’五个选项。
#   - 操作：点击页面底部导航栏中的‘未登录’选项。
#   - 解释：点击‘未登录’选项可以进入登录界面，从而输入账号和密码进行登录。这一步操作是必要的，因为只有进入登录界面后，才能输入账号和密码完成登录操作。
#   步骤2：
#   - 页面：当前页面是高德地图的登录界面。页面上方显示了欢迎语“便捷，用高德”，并有一个蓝色的“一键登录，享受定制化推荐”按钮。下方有一个“其他登录方式”的链接，页面底部有多个功能选项，包括“全部订单”、“待付款”、“待使用”、“退款/取消”、“待评价”等。
#   - 操作：点击“其他登录方式”链接。
#   - 解释：当前页面的“一键登录”按钮可能是使用快捷方式登录，而“其他登录方式”链接可能会提供更多的登录选项，包括手动输入账号和密码的方式。为了使用账号和密码登录，点击“其他登录方式”链接是必要的步骤。
#   步骤3：
#   - 页面：当前页面是高德地图的登录界面，显示了一个欢迎回来的信息，并提供了通过手机号和验证码登录的选项。页面中有一个输入手机号的文本框，默认显示了一个手机号‘176 1129 9528’。下方有一个复选框，提示用户阅读并同意服务条款和隐私政策。页面中间有一个蓝色的‘获取验证码’按钮。页面底部有‘账号密码登录’和‘登录遇到问题？’两个选项，以及其他登录方式的图标。
#   - 操作：点击页面底部的‘账号密码登录’选项。
#   - 解释：当前页面默认是通过手机号和验证码登录的方式，因此需要切换到账号密码登录的方式。点击‘账号密码登录’选项是必要的步骤，以便进入账号密码登录界面，输入账号和密码进行登录。
#   步骤4：
#   - 页面：当前页面是高德地图的登录界面。页面上方有一个欢迎登录高德的标志。下方有两个输入框，分别用于输入手机号/邮箱/用户名和密码。输入框下方有一个复选框，提示用户阅读并同意服务条款和隐私政策。再往下是一个蓝色的登录按钮。页面底部有其他登录方式的图标，包括支付宝、淘宝、微信、QQ和微博。
#   - 操作：在标记的输入框中输入账号。
#   - 解释：首先在登录界面输入用户名，这是登录操作的第一步。输入正确的用户名是登录成功的前提，因此在标记的输入框中输入账号是必要的操作。
#   步骤5：
#   - 页面：当前页面是高德地图的登录界面。页面上方显示了欢迎登录高德的标志和文字。下方有两个输入框，第一个输入框中已经输入了账号，第二个输入框显示‘请输入密码’的提示文字。再往下是一个复选框，提示用户阅读并同意服务条款和隐私政策。页面底部有一个蓝色的‘登录’按钮，以及其他登录方式的图标。
#   - 操作：在第二个输入框中输入密码。
#   - 解释：账号已经输入在第一个输入框中，接下来需要在第二个输入框中输入对应的密码。输入密码是登录操作的必要步骤，只有在输入正确的账号和密码后，才能点击‘登录’按钮完成登录。
#   步骤6：
#   - 页面：当前页面是高德地图的登录界面。页面上方显示了一个欢迎登录高德的图标和文字。下方有两个输入框，分别用于输入账号和密码。账号输入框中已经填入了账号，密码输入框中显示为掩码状态。输入框下方有一个复选框，旁边的文字是'我已阅读并同意《服务条款》《高德地图基本功能隐私政策》；未注册的手机号将自动注册'。再下方是一个蓝色的'登录'按钮。页面底部有其他登录方式的图标。
#   - 操作：点击复选框以同意服务条款和隐私政策。
#   - 解释：在使用账号和密码登录高德地图之前，必须同意服务条款和隐私政策。点击复选框是为了表示同意这些条款，这是登录操作的必要步骤。
#   步骤7：
#   - 页面：这是高德地图的登录页面。页面上方显示了欢迎登录高德的提示。中间部分有两个输入框，分别用于输入账号和密码。账号输入框中已经填入了账号，密码输入框中显示为掩码形式。输入框下方有一个复选框，表示用户已阅读并同意《服务条款》和《高德地图基本功能隐私政策》，该复选框已被选中。再下方是一个蓝色的'登录'按钮。页面底部提供了其他登录方式，包括支付宝、淘宝、微信、QQ和微博。
#   - 操作：点击蓝色的‘登录’按钮。
#   - 解释：在输入了正确的账号和密码，并同意了服务条款和隐私政策后，点击‘登录’按钮是完成登录操作的最后一步。
# 完成以上步骤后，用户将成功使用账号和密码登录高德地图，进入高德地图的主界面。
# \"\"\"
# """

#     prompt += """\"\"\"
# --- 操作文档：如何导航到背景音提取页面 ---
# * 起始页面：音乐推荐页面
# * 操作步骤：
#   步骤1：
#   - 页面：当前页面是一个音乐推荐页面，顶部有推荐和儿童两个标签。页面中部有一个搜索栏，下面是一个大幅的音乐推荐图片。页面下方有多个功能按钮，包括“现在就听”、“歌手”、“歌单”、“排行榜”、“超高音质”等。页面底部有导航栏，包括“首页”、“直播”、“听书”、“视频”、“我的”五个选项。
#   - 操作：点击页面右上角的三条横线图标。
#   - 解释：点击右上角的三条横线图标可以打开一个侧边菜单或更多选项，从而找到导航到背景音提取页面的入口。通常情况下，三条横线图标代表菜单或更多选项，可能包含用户需要的功能。
#   步骤2：
#   - 页面：当前页面是一个音乐应用的主界面，顶部有一个推广会员特权的横幅。下方有多个功能选项，包括听歌识曲、背景音提取、导入外部歌单和音乐云盘等。页面中部有铃声彩铃专区、听歌玩游戏、每日免费领VIP、免流量听歌和商城等选项。
#   - 操作：点击页面中部的“背景音提取”选项。
#   - 解释：通过点击“背景音提取”选项，可以直接进入相关功能页面，这是实现导航到背景音提取页面的最直接和有效的方法。
#   步骤3：
#   - 页面：页面标题为“背景音提取”，包含两个选项卡：“本地提取”和“链接提取”，其中“本地提取”被选中。页面中显示了一段说明文字：“1. 在本地文件中，选择您需要提取背景音的视频文件。” 下方有一个按钮，文字为“查看本地视频文件”。页面中部展示了一个视频文件列表，包含多个视频缩略图。
#   - 操作：无进一步操作。
#   - 解释：此时已经成功导航到背景音提取页面，用户可以根据需要选择本地视频文件进行背景音提取。
# 通过以上步骤，用户可以成功导航到背景音提取页面，并在该页面选择本地视频文件进行背景音提取。
# \"\"\"
# """

    prompt += """\"\"\"
--- 操作文档：如何创建一个新的歌单 ---
* 起始页面：音乐应用的推荐页面
* 操作步骤：
  步骤1：
  - 页面：当前页面是音乐应用的推荐页面，顶部有搜索栏和一些功能按钮。页面中部有广告和推荐歌单，底部有导航栏，包括“首页”、“直播”、“听书”、“视频”和“我的”五个选项。
  - 操作：点击底部导航栏中的“我的”按钮。
  - 解释：要创建一个新的歌单，通常需要进入个人中心或用户相关的页面。在当前的推荐页面中，没有直接的创建歌单选项，因此需要点击底部导航栏中的“我的”按钮，进入个人中心页面，可能会找到创建歌单的选项。
  步骤2：
  - 页面：当前页面是音乐应用的个人中心页面，显示了用户的基本信息、会员中心入口、最近播放、收藏、下载等功能。页面中部有一个“自建歌单”部分，右侧有一个加号图标，可能用于创建新的歌单。
  - 操作：左滑页面中部的“本地”、“最近播放”、“收藏”、“下载”等功能控件。
  - 解释：左滑这些控件可能会显示更多的功能选项或操作按钮，例如创建新的歌单。通过左滑操作，用户可以发现隐藏的功能，从而找到创建歌单的入口。
  步骤3：
  - 页面：页面显示了用户的个人信息和音乐应用的主要功能。页面顶部显示了用户的电话号码和会员中心按钮。页面中部有五个主要功能按钮，分别是收藏、下载、歌单、已购和我的K歌。页面下方显示了用户的听书记录和自建歌单的选项。
  - 操作：点击页面中部的歌单按钮。
  - 解释：点击歌单按钮可以进入管理和创建歌单的页面。这个操作是必要的，因为创建新的歌单通常需要先进入歌单管理界面，从而找到创建新歌单的选项。
  步骤4：
  - 页面：页面显示了一个歌单管理界面，顶部有两个标签：自建歌单和收藏歌单。当前选中的是自建歌单标签。页面中间有一个带加号的按钮，旁边写着“新建歌单”。底部显示了当前播放的歌曲信息。
  - 操作：点击带加号的“新建歌单”按钮。
  - 解释：页面中带加号的“新建歌单”按钮明显是用于创建新歌单的控件，点击该按钮是实现这一操作的直接方法。
  步骤5：
  - 页面：页面显示了一个音乐应用的歌单管理界面。页面顶部有两个标签：'自建歌单'和'收藏歌单'，当前选中的是'自建歌单'。在页面的左侧有一个带加号的按钮，标记为'新建歌单'。在页面底部弹出一个对话框，标题为'新建歌单'，其中包含一个默认名称为'新建歌单 1'的输入框，以及一个可选的复选框，标记为'设置为隐私歌单'。对话框底部有两个按钮，分别是'取消'和'确定'。
  - 操作：点击对话框底部的'确定'按钮。
  - 解释：当前页面已经显示了新建歌单的对话框，并且默认名称已经填入。点击'确定'按钮是确认创建歌单的最后一步操作，因此选择点击'确定'按钮来完成新歌单的创建。
操作完成后，用户将看到一个新建的歌单页面，歌单名称为“新建歌单 1”。页面中包含一个默认的歌单封面图片、创建者的电话号码以及一个“编辑简介”的选项。页面中部显示“没有歌曲”的提示，并有一个“添加歌曲”的按钮。
\"\"\"
"""

    prompt += """
请判断其介绍的内容是否和当前的操作意图是否相关。如果相关，请确定你处于文档中描述的哪个页面。在操作意图相关且能找到对应页面的情况下，你应该尽量遵循文档中的操作步骤。
"""

# ---------------------------------------------------------提示---------------------------------------------------------

    prompt += """\n### 提示
1. 你只能调用一个操作函数，所以请只考虑紧接着的单步交互操作。
2. 你需要判断当前页面与操作意图是否处在一个功能模组中，如果不是，可能需要先返回到主页面或上层页面。
3. 在查找内容时，搜索通常比滚动页面更有效。请只在你非常确定目标内容无法通过搜索找到时才使用滚动页面进行查找。
4. 你需要判断当前页面处于的具体条目或内容是否是操作意图指定的条目或内容，如果不是，你的操作应该是找到正确的条目或内容。
5. 确保你操作的条目或内容和操作意图完全对应非常重要。页面中有一些条目或内容可能和操作意图部分相关，但你不应该就这些条目或内容进行操作，而是应该寻找和操作意图完全对应的条目或内容。
6. 如果你想操作的控件在第二张截图上被标注了多个编号，你在调用操作函数时应传入标注位置最靠近控件中心的编号。\n"""
    if len(history) > 0:
        prompt += "7. 如果你感觉历史操作没有实现预期的效果，你需要考虑其他思路而不是重复同一操作。\n"

# -------------------------------------------------------输出格式-------------------------------------------------------

#     if len(history) > 0:
#         prompt += """\n### 格式化输出
# 你的输出应包括以下五个部分，并按照此格式：
# 1. 观察：<描述你在应用界面中观察到的内容，尤其是和操作意图相关的部分。>
# 2. 反思：<判断你的历史操作是否达到了预期的效果。如果没有，说明你的历史操作存在问题，并描述你的调整思路。>
# 3. 推理：<根据给定的操作意图和你的调整思路，用自然语言完整描述你推理出正确的单步交互操作的过程。>
# 4. 操作：<调用“交互操作”中描述的一个函数来实现操作。>
# 5. 总结：<总结你刚刚作出的操作。>"""
#     else:
#         prompt += """\n### 格式化输出
# 你的输出应包括以下四个部分，并按照此格式：
# 1. 观察：<描述你在应用界面中观察到的内容，尤其是和操作意图相关的部分。>
# 2. 推理：<根据给定的操作意图，用自然语言完整描述你推理出正确的单步交互操作的过程。>
# 3. 操作：<调用“交互操作”中描述的一个函数来实现操作。>
# 4. 总结：<总结你刚刚作出的操作。>"""

    if len(history) > 0:
        prompt += """\n### 格式化输出
你的输出应该按照以下格式，确保能被json文件正确解析：
```json
{
    "观察": "描述你在应用界面中观察到的内容，尤其是和操作意图相关的部分。"
    "反思": "判断你的历史操作是否达到了预期的效果。如果没有，说明你的历史操作存在问题，并描述你的调整思路。"
    "推理": "根据给定的操作意图和你的调整思路，用自然语言完整描述你推理出正确的单步交互操作的过程。"
    "操作": "调用“交互操作”中描述的一个函数来实现操作。"
    "总结": "总结你刚刚作出的操作。>
}
```"""
    else:
        prompt += """\n### 格式化输出
你的输出应该按照以下格式，确保能被json文件正确解析：
```json
{
    "观察": "描述你在应用界面中观察到的内容，尤其是和操作意图相关的部分。"
    "推理": "根据给定的操作意图和你的调整思路，用自然语言完整描述你推理出正确的单步交互操作的过程。"
    "操作": "调用“交互操作”中描述的一个函数来实现操作。"
    "总结": "总结你刚刚作出的操作。>
}
```"""

# -------------------------------------------------------回答示例-------------------------------------------------------

#     prompt += """\n### 回答示例
# - 示例1（操作意图为“播放甄嬛传”）：
# 1. 观察： 当前界面是影视类应用的主界面。页面顶部有一个搜索栏（标签为2），其中预填的内容是“庆余年”。下方是各种影视类别的标签，当前选中的是“古装”。标签栏下方是若干古装影视作品的标题、海报和基本信息。页面底部是控制栏，有“主页”、“会员专区”、“发现”和“我的”四个选项。
# 2. 思考：为了播放《甄嬛传》，我需要在搜索栏中输入“甄嬛传”并搜索。最有效的下一个单步交互操作是在搜索栏（标签为2）中输入“甄嬛传”。
# 3. 操作：`text(2, "甄嬛传")`
#
# - 示例2（操作意图为“播放热门摇滚乐列表”）：
# 1. 观察：当前界面显示音乐类应用的主页。页面顶部是一个搜索栏，下方是用户当前的播放列表和“猜你爱听”的歌曲目录。再下方有各种热门音乐排行榜，其中包含“摇滚乐榜”（标签为4）。页面底部是控制栏，有“首页”、“直播”、“雷达”、“派对”、“我的”五个选项。
# 2. 思考：为了播放热门摇滚乐列表，最有效的下一个单步交互操作是点击热门音乐排行榜中的“摇滚乐榜”（标签为4）。
# 3. 操作：`click(4)`
#
# - 示例3（操作意图为“购买一双雪地靴”）：
# 1. 观察：当前界面处于购物类应用内置的游戏模块“芭芭农场”中。页面顶部有一个返回按钮（标签为1），页面中部显示了游戏内容和各种互动按钮。
# 2. 思考：为了购买雪地靴，需要退出“芭芭农场”模块。最有效的下一个单步交互操作是返回到主页面或上层页面。调用系统级返回操作或者点击页面顶部的返回按钮（标签为1）都可以达到目的，我选择调用系统级返回操作。
# 3. 操作：`back()`
#
# - 示例4（操作意图为“删除联系人‘张伟’”）：
# 1. 观察：当前界面显示的是通讯录应用的联系人列表。页面顶部有一个搜索栏，页面中部是按字母顺序排列的联系人列表。页面底部是“添加联系人”和“设置”两个选项。联系人列表中有一个名为“张伟”的联系人条目（标签为6）。
# 2. 思考：为了删除联系人“张伟”，需要向左滑动联系人“张伟”所在的条目（标签为6）以显示删除按钮。
# 3. 操作：`swipe(6, "left")`
#
# - 示例5（操作意图为“标记所有未读对话为已读”）：
# 1. 观察：当前界面显示的是聊天类应用的对话列表。页面顶部有一个搜索栏，页面中部显示的是和不同联系人的对话列表，其中部分对话条目带有未读消息标记。页面底部有“对话”、“通讯录”、“发现”、“我”四个选项。未读对话的标签分别为3、4、6、9。
# 2. 思考：为了标记所有未读对话为“已读”，需要从其中一个开始。按照从上到下的顺序，先标记和“陈国强”的对话条目（标签为3）为已读。因此，应该长按和“陈国强”的对话条目（标签为3）以显示标为已读的选项。
# 3. 操作：`long_press(3)`
#
# - 示例6（操作意图为“查看热榜”）：
# 1. 观察：当前界面显示的是一款知识类应用的热榜界面。页面顶部有“推荐”、“关注”和“热榜”三个标签，当前选中的是“热榜”。页面中部是当前热门的讨论条目。页面底部有一个控制栏，其中包括四个图标控件。从图标分析，这四个控件分别对应“主页”、“新建问题”、“会员信息”和“用户信息”。
# 2. 思考：目前已经处于热榜界面，操作意图已经达成，因此无需执行任何操作。
# 3. 操作：`finish()`
#
# - 示例7（操作意图为“查看‘李晓明’的朋友圈”）：
# 1. 观察：当前界面显示的是一款射击类游戏应用的游玩界面。页面中间是第三人称视角的游戏角色，他背着战斗背包并手持一把步枪。场景的远处有几处房屋和树。页面两侧有一些控件，对应不同的操作。
# 2. 思考：该应用为游戏应用，无朋友圈功能，因此无法执行任何操作以完成目标意图。
# 3. 操作：`finish()`"""

    return prompt


def get_description_prompt():

    prompt = """请从以下四个方面描述当前手机页面的特征：

### 注意事项
1. 请确保对页面性质、页面布局和页面功能的描述尽可能泛化，避免涉及具体的、实时的内容，而是集中描述页面的共性。这意味着同一类型应用中相似性质的页面，你的描述应当同样适用。
2. 如果页面顶部有状态栏或页面底部有“ADB Keyboard {ON}”的字样，请忽略它们，不纳入描述范围。

### 输出内容
你的输出应包括以下四个部分：
1. **应用类型**：<描述当前应用的类型，如“影视类应用”、“音乐类应用”等。>”
2. **页面性质**：<描述该页面的性质，如“首页”、“消息页面”等。尽量确保描述能体现页面的独特性，即具备这种描述的页面在同一应用中是唯一的。>”
3. **页面布局**：<从上到下详细描述页面的全部布局，包括功能块、控件、信息展示等内容，但不要描述具体信息，而是使用泛化表述。例如，如果页面中某一部分显示了是电视剧《西游记》的海报，你应该表述为“显示了一部影视的海报”。>”
4. **页面功能**：<详细罗列所有该页面能够实现的功能。>”
请确保你的描述能够提供对页面的结构和功能的清晰概括，而无需具体应用和内容的详细信息。

### 输出格式
你的输出应该按照以下格式，确保能被json文件正确解析：
{
    "应用类型": "填写应用类型",
    "页面性质": "填写页面性质",
    "页面布局": {
        "填写功能块1的名称": "填写对功能块1的描述",
        "填写功能块2的名称": "填写对功能块2的描述",
        "填写功能块3的名称": "填写对功能块3的描述",
        // 请继续填写后续功能块
    },
    "页面功能": {
        "填写功能1的名称": "填写对功能1的描述",
        "填写功能2的名称": "填写对功能2的描述",
        "填写功能3的名称": "填写对功能3的描述",
        // 请继续填写后续功能
    }
}"""
    return prompt


def get_reference_prompt(instruction, operation="", final=False):
    if not final:
        prompt = f"第一张图片是手机当前页面的截图。为了实现操作意图“{instruction}”，领域专家认为应该{operation}。请描述截图中的页面和领域专家的操作，分析他的思考逻辑。\n\n"

        prompt += """### 格式化输出
你的输出应该按照以下格式，确保能被json文件正确解析：
```json
{
    "页面": "描述第一张截图中的页面，专注于和操作意图以及领域专家的操作有逻辑关联的部分。",
    "操作": "详细描述领域专家的操作。",
    "思考": "尝试解读领域专家作出这一操作的推理过程，分析其必要性",
}
```"""
    else:
        prompt = f"为了实现操作意图“{instruction}”，领域专家的操作完成后会结束在这一页面。请对其进行描述。\n\n"

        prompt += """### 格式化输出
你的输出应该按照以下格式，确保能被json文件正确解析：
```json
{
    "页面": "描述截图中的页面，着重于和操作意图有逻辑关联的部分。",
}
```"""

    return prompt


# def get_reference_prompt_qwen(instruction, operation="", final=False):
#     prompt = "你是一个专注于智能手机操作描述和理解的AI助手。"
#
#     if not final:
#         prompt += f"第一张图片是手机当前页面的截图。为了实现操作意图“{instruction}”，领域专家认为应该{operation}。请描述截图中的页面和领域专家的操作，分析他的思考逻辑。\n"
#     else:
#         prompt = f"为了实现操作意图“{instruction}”，领域专家的操作完成后会结束在这一页面。请对其进行描述。\n"
#
#     prompt += """
# 请特别注意以下几点：
# 1. 如果页面的顶部有状态栏或底部有“ADB Keyboard {ON}”的字样，请忽略这些部分，描述时不需要提及。
# 2. 描述页面时应重点关注与操作意图和领域专家的操作逻辑相关的信息，可能包括页面的性质、功能，以及标签或复选框的选中情况等。
# 3. 在描述操作时，避免使用“第一张截图”或“第二张截图”等字眼，而是直接描述操作。
# 4. 我借由画框来指示操作，但你在描述时应当忽略此类框，而是描述实际的操作。
# """
#
#     if not final:
#         prompt += """
# ### 格式化输出
# 你的输出应该按照以下格式，确保能被json文件正确解析：
# ```json
# {
#     "页面": "描述第一张截图中的页面，专注于和操作意图以及领域专家的操作有逻辑关联的部分。",
#     "操作": "详细描述领域专家的操作。",
#     "思考": "尝试解读领域专家作出这一操作的推理过程，分析其必要性",
# }
# ```
# """
#     else:
#         prompt += """
# ### 格式化输出
# 你的输出应该按照以下格式，确保能被json文件正确解析：
# ```json
# {
#     "页面": "描述截图中的页面，着重于和操作意图有逻辑关联的部分。",
# }
# ```
# """
#
#     return prompt


def get_reference_prompt_qwen(instruction, operation="", final=False):
    prompt = "你是一个专注于智能手机操作描述和理解的AI助手。"

    if not final:
        prompt += f"这张图片是手机当前页面的截图。为了实现操作意图“{instruction}”，领域专家认为应该{operation}。请描述截图中的页面和领域专家的操作，分析他的思考逻辑。\n"
    else:
        prompt = f"为了实现操作意图“{instruction}”，领域专家的操作完成后会结束在这一页面。请对其进行描述。\n"

    prompt += """
请特别注意以下几点：
1. 如果页面的顶部有状态栏或底部有“ADB Keyboard {ON}”的字样，请忽略这些部分，描述时不需要提及。
2. 描述页面时应重点关注与操作意图和领域专家的操作逻辑相关的信息，可能包括页面的性质、功能，以及标签或复选框的选中情况等。
3. 我借由画框来指示操作，但你在描述时应当忽略此类框，而是描述实际的操作。
"""

    if not final:
        prompt += """
### 格式化输出
你的输出应该按照以下格式，确保能被json文件正确解析：
```json
{
    "页面": "描述截图中的页面，专注于和操作意图以及领域专家的操作有逻辑关联的部分。",
    "操作": "详细描述领域专家的操作。",
    "思考": "尝试解读领域专家作出这一操作的推理过程，分析其必要性",
}
```
"""
    else:
        prompt += """
### 格式化输出
你的输出应该按照以下格式，确保能被json文件正确解析：
```json
{
    "页面": "描述截图中的页面，着重于和操作意图有逻辑关联的部分。",
}
```
"""

    return prompt


def get_reference_summary_prompt(instruction, steps):

    prompt = f"""领域专家在完成操作意图“{instruction}”时，经历了以下页面和操作达成了目标：\n"""
    prompt += steps
    prompt += "\n请根据这些操作步骤总结出操作文档，帮助不熟悉该App或类似App的用户实现相关的操作意图。最后一个步骤应该使得手机跳转到所描述的最后一个页面，该页面无需专门描述，其后也不应有任何操作。\n\n"

    prompt += """### 格式化输出
你的输出应该按照以下格式，确保能被JSON文件正确解析：
```json
{
    "操作意图": "请填写该文档适用的操作意图。"
    "起始页面": "请填写该文档适用的起始页面，通常是App的首页。",
    "步骤1": {
        "页面": "请详细描述步骤1操作前的页面，确保用户能够判断自己是否在正确的页面上。",
        "操作": "请详细描述步骤1的操作，如点击按钮、输入文本等。",
        "解释": "请详细解释操作的原因，如为什么选择这个按钮、这个文本框的作用是什么等。",
    },
    "步骤2": {
        "页面": "请详细描述步骤2操作前的页面。",
        "操作": "请详细描述步骤2的操作。",
        "解释": "请详细解释操作的原因。",
    },
    "步骤3": {
        "页面": "请详细描述步骤3操作前的页面。",
        "操作": "请详细描述步骤3的操作。",
        "解释": "请详细解释操作的原因。",
    },
    // 请继续填写后续步骤
    "总结": "告知用户操作完成后达成的效果。"
}
```"""

    return prompt
